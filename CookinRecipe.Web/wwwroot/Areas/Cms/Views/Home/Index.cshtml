@{
    ViewData["Title"] = "Cms Page";
}

<style>
    .gap-row div[class*="col-"] {
        padding-bottom: 15px;
    }

    .table_select .dataTables_wrapper {
        display: none;
    }

    #dataGrid_wrapper {
        display: block;
    }

    .gap-row div[class*="total-"] {
        display: flex;
        flex-direction: column;
        cursor: pointer;
    }

        .gap-row div[class*="total-"] label:first-child {
            color: #363636;
            font-family: Mulish;
            font-size: 16px;
            font-style: normal;
            font-weight: 400;
            line-height: 1.5; /* 150% */
            opacity: 0.7;
            cursor: pointer;
        }

        .gap-row div[class*="total-"] label:last-child {
            font-family: Mulish;
            font-size: 26px;
            font-style: normal;
            font-weight: 500;
            line-height: 1.3; /* 123.077% */
            cursor: pointer;
            width: min-content
        }

    .gap-row div[class*="col-"]:nth-child(1) div[class*="total-"] label:last-child {
        color: #F2BC16;
    }

    .gap-row div[class*="col-"]:nth-child(2) div[class*="total-"] label:last-child {
        color: #478FFC;
    }

    .gap-row div[class*="col-"]:nth-child(3) div[class*="total-"] label:last-child {
        color: #2DC58C;
    }

    .label_loc {
        text-align: right;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        line-height: 38px !important;
    }
</style>

<div class="contentTitle">
    <h3 class="center-align">THỐNG KÊ</h3>
</div>

<div class="row gap-row">
    <div class="col-md-4">
        <div class="form-container total-ho-chieu">
            <label>Hộ chiếu đăng kí trong ngày</label>
            <label id="total-ho-chieu" title="Bấm vào để tải file thống kê Excel"></label>
        </div>
    </div>
    <div class="col-md-4">
        <div class="form-container total-ho-chieu-thang">
            <label>Hộ chiếu tham gia chương trình trong tháng</label>
            <label id="total-ho-chieu-thang" title="Bấm vào để tải file thống kê Excel"></label>
        </div>
    </div>
    <div class="col-md-4">
        <div class="form-container total-ho-chieu-ht-thang">
            <label>Hộ chiếu hoàn thành chương trình trong tháng</label>
            <label id="total-ho-chieu-ht-thang" title="Bấm vào để tải file thống kê Excel"></label>
        </div>
    </div>
    <div class="col-md-12">
        <div class="form-container table_select">
            <div class="table-tree-wrapper table-pagination-outside">
                <div class="row" style="position: absolute;right: 20px;width:58%">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="label_loc">Ngày tạo:</label>
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            <input class="form-control dd-mm-yyyy" type="text" id="start" placeholder="Nhập ngày bắt đầu..." />
                        </div>
                    </div>
                    <div class="col-md-5">
                        <div class="form-group">
                            <input class="form-control dd-mm-yyyy" type="text" id="end" placeholder="Nhập ngày kết thúc..." />
                        </div>
                    </div>
                </div>
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGrid" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Họ tên</th>
                                <th>Giới tính</th>
                                <th>Hộp thư</th>
                                <th>Mã hộ chiếu</th>
                                <th>Ngày sinh</th>
                                <th>Quốc tịch</th>
                                <th>Địa chỉ</th>
                                <th>Số điện thoại</th>
                                <th>Số tài khoản</th>
                                <th>Số giấy tờ tuỳ thân</th>
                                <th>Ngày tạo</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="table-tree-wrapper table-pagination-outside">
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGrid1" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Họ tên</th>
                                <th>Giới tính</th>
                                <th>Hộp thư</th>
                                <th>Mã hộ chiếu</th>
                                <th>Ngày sinh</th>
                                <th>Quốc tịch</th>
                                <th>Chương trình</th>
                                <th>Địa chỉ</th>
                                <th>Số điện thoại</th>
                                <th>Số tài khoản</th>
                                <th>Số giấy tờ tuỳ thân</th>
                                <th>Ngày tham gia</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <div class="table-tree-wrapper table-pagination-outside">
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGrid2" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Họ tên</th>
                                <th>Giới tính</th>
                                <th>Hộp thư</th>
                                <th>Mã hộ chiếu</th>
                                <th>Ngày sinh</th>
                                <th>Quốc tịch</th>
                                <th>Chương trình</th>
                                <th>Địa chỉ</th>
                                <th>Số điện thoại</th>
                                <th>Số tài khoản</th>
                                <th>Số giấy tờ tuỳ thân</th>
                                <th>Giấy chứng nhận</th>
                                <th>Ngày hoàn thành</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="contentTitle">
    <h3 class="center-align">THỐNG KÊ NGƯỜI ĐĂNG KÝ CHƯƠNG TRÌNH</h3>
</div>

<div class="row gap-row">
    <div class="col-md-12">
        <div class="form-container">
            <div class="table-tree-wrapper table-pagination-outside">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Mã hộ chiếu</label>
                            <input type="text" class="form-control" id="MaHoChieuLoc">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Họ và tên</label>
                            <input type="text" class="form-control" id="HoTenLoc">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Quốc tịch</label>
                            <input type="text" class="form-control" id="QuocGiaLoc">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Tỉnh thành</label>
                            <input type="text" class="form-control" id="TinhThanhLoc">
                        </div>
                    </div>
                </div>
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGridHoChieuThamGia" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr class="table-primary">
                                <th rowspan="2">STT</th>
                                <th rowspan="2">Mã hộ chiếu</th>
                                <th rowspan="2">Họ và tên</th>
                                <th rowspan="2">Quốc tịch</th>
                                <th rowspan="2">Tỉnh thành</th>
                                <th colspan="2" class="text-center">Danh sách chương trình</th>
                                <th colspan="2" class="text-center">Số điểm tham quan đã check in</th>
                                <th rowspan="2">Điểm kinh nghiệm theo chương trình</th>
                            </tr>
                            <tr class="table-primary">
                                <th>Tham gia</th>
                                <th>Hoàn thành</th>
                                <th>Theo chương trình tham quan</th>
                                <th>Theo chương trình ẩm thực</th>
                            </tr>
                            <tr class="filter-row">
                                <th></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Mã hộ chiếu" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Họ tên" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Quốc tịch" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Tỉnh thành" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Danh sách chương trình tham gia" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Danh sách chương trình hoàn thành" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Số điểm tham quan đã checkin theo chương trình tham quan" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Số điểm tham quan đã checkin theo chương trình ẩm thực" /></th>
                                <th><input type="text" class="column-search" style="display:none" placeholder="Điểm kinh nghiệm theo chương trình" /></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="contentTitle">
    <h3 class="center-align">THỐNG KÊ NGƯỜI ĐĂNG KÝ CHƯƠNG TRÌNH MÓN ĂN</h3>
</div>

<div class="row gap-row">
    <div class="col-md-12">
        <div class="form-container">
            <div class="table-tree-wrapper table-pagination-outside">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Chọn tiêu chí:</label>
                            <select class="select2" id="TieuChiThongKe">
                                <option>Lượt khách</option>
                                <option>Lượt tham gia chương trình</option>
                                <option>Lượt check in món ăn</option>
                                <option>Lượt check in địa điểm</option>
                                <option>Lượt đăng ký</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Thời gian:</label>
                            <input class="form-control dd-mm-yyyy" type="text" id="ThoiGianLoc" placeholder="Nhập ngày..." />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Quốc gia:</label>
                            <input type="text" class="form-control" id="QuocGiaLoc2">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Tỉnh thành:</label>
                            <input type="text" class="form-control" id="TinhThanhLoc2">
                        </div>
                    </div>
                </div>
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGridThamGiaCTMonAn" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th rowspan="2">STT</th>
                                <th rowspan="2">Tên chương trình</th>
                                <th rowspan="2">Số lượng người tham gia</th>
                                <th colspan="3" class="text-center">Số lượng người hoàn thành mức độ</th>
                                <th colspan="2" class="text-center">Số lượng người hoàn thành mức độ</th>
                            </tr>
                            <tr>
                                <th>Mức độ 1</th>
                                <th>Mức độ 2</th>
                                <th>Mức độ 3</th>
                                <th>Trong nước</th>
                                <th>Nước ngoài</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="contentTitle">
    <h3 class="center-align">THỐNG KÊ LƯỢT CHECK IN MÓN ĂN</h3>
</div>

<div class="row gap-row">
    <div class="col-md-12">
        <div class="form-container">
            <div class="table-tree-wrapper table-pagination-outside">
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGridLuotCheckInMonAn" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên món</th>
                                <th>Trong nước</th>
                                <th>Nước ngoài</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="contentTitle">
    <h3 class="center-align">THỐNG KÊ LƯỢT KHÁCH</h3>
</div>

<div class="row gap-row">
    <div class="col-md-12">
        <div class="form-container">
            <div class="table-tree-wrapper table-pagination-outside">
                <div style="width:100%; margin:0 auto;">
                    <table id="dataGridLuotKhachMonAn" class="table-border row-border compact table" cellspacing="0">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Lượt đăng ký</th>
                                <th>Lượt tham gia</th>
                                <th>Lượt hoàn thành</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="DSThamGiaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DSThamGiaModalLabel">Danh sách người tham gia</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="ModalDSThamGia">
                <div class="table-tree-wrapper table-pagination-outside">
                    <div style="width:100%; margin:0 auto;">
                        <table id="dataGridDSThamGia" class="table-border row-border compact table" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Họ và tên</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-white" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        let tokenJWT = '@ViewBag.TokenJWT';

        // Thong Ke Nguoi Dang Ki Chuong Trinh
        $(document).ready(function () {
            loadData();

            // Hàm gọi API và đổ dữ liệu vào bảng
            function loadData() {
                $.ajax({
                    url: '/API/HoChieuHanhKhach/GetDanhSachHoChieuDuKhach',
                    type: 'GET',
                    success: function (data) {
                        var html = '';
                        console.log("Dữ liệu trả về:", data);

                        // Kiểm tra nếu API trả về thành công và resultObj tồn tại
                        if (data.isSuccessed && Array.isArray(data.resultObj)) {
                            $.each(data.resultObj, function (i, item) { // Sửa data thành data.resultObj
                                // Xử lý tinhThanh: nếu null thì hiển thị chuỗi rỗng hoặc giá trị mặc định
                                var tinhThanh = item.tinhThanh ? item.tinhThanh : 'null';

                                // chuong Trinh Am Thuc Tham Gia
                                var chuongTrinhThamGiaCount = item.listChuongTrinhAmThucThamGia ? item.listChuongTrinhAmThucThamGia.length : 0;
                                var chuongTrinhThamGiaList = '';

                                if (chuongTrinhThamGiaCount > 0) {
                                    chuongTrinhThamGiaList += '<ul style="margin: 0; padding-left: 20px;">';
                                    $.each(item.listChuongTrinhAmThucThamGia, function (index, program) {
                                        // Lặp qua chillChuongTrinhAmThucs để lấy tenChuongTrinh
                                        if (program.chillChuongTrinhAmThucs && program.chillChuongTrinhAmThucs.length > 0) {
                                            $.each(program.chillChuongTrinhAmThucs, function (j, amThuc) {
                                                chuongTrinhThamGiaList += `<li>${amThuc.tenChuongTrinh}</li>`;
                                            });
                                        }
                                    });
                                    chuongTrinhThamGiaList += '</ul>';
                                }

                                //chuong Trinh Am Thuc HoanThanh
                                var chuongTrinhHoanThanhCount = item.listChuongTrinhAmThucHoanThanh ? item.listChuongTrinhAmThucHoanThanh.length : 0;
                                var chuongTrinhHoanThanhList = '';

                                if (chuongTrinhHoanThanhCount > 0) {
                                    chuongTrinhHoanThanhList += '<ul style="margin: 0; padding-left: 20px;">';
                                    $.each(item.listChuongTrinhAmThucHoanThanh, function (index, program) {
                                        // Lặp qua chillChuongTrinhAmThucs để lấy tenChuongTrinh
                                        if (program.chillChuongTrinhAmThucs && program.chillChuongTrinhAmThucs.length > 0) {
                                            $.each(program.chillChuongTrinhAmThucs, function (j, amThuc) {
                                                chuongTrinhHoanThanhList += `<li>${amThuc.tenChuongTrinh}</li>`;
                                            });
                                        }
                                    });
                                    chuongTrinhHoanThanhList += '</ul>';
                                }

                                //diem Kinh Nghiem By ChuongTrinh
                                var diemKinhNghiemList = '';
                                if (item.diemKinhNghiemByChuongTrinh && item.diemKinhNghiemByChuongTrinh.length > 0) {
                                    $.each(item.diemKinhNghiemByChuongTrinh, function (index, diem) {
                                        diemKinhNghiemList += (index > 0 ? '<br>' : '') + `${diem.tenChuongTrinh}: ${diem.diemKinhNghiem}`;
                                    });
                                } else {
                                    diemKinhNghiemList = 'Không có điểm kinh nghiệm';
                                }

                                //So Diem Tham Quan Da CheckIn
                                var diemThamQuanList = '';
                                if (item.listDemSoDiemThamQuanCheckIn && item.listDemSoDiemThamQuanCheckIn.length > 0) {
                                    $.each(item.listDemSoDiemThamQuanCheckIn, function (index, diem) {
                                        diemThamQuanList += (index > 0 ? '<br>' : '') + `${diem.tenChuongTrinh}: ${diem.soLuong}`;
                                    });
                                } else {
                                    diemThamQuanList = 'null';
                                }
                                //So MonAn Da CheckIn
                                var chuongTrinhMonAn = '';
                                if (item.listDemSoMonAnCheckIn && item.listDemSoMonAnCheckIn.length > 0) {
                                    $.each(item.listDemSoMonAnCheckIn, function (index, diem) {
                                        chuongTrinhMonAn += (index > 0 ? '<br>' : '') + `${diem.tenChuongTrinh}: ${diem.soLuong}`;
                                    });
                                } else {
                                    chuongTrinhMonAn = 'null';
                                }

                                html += `<tr>
                                            <td>${i + 1}</td>
                                            <td>${item.maHoChieu}</td>
                                            <td>${item.hoTen}</td>
                                            <td>${item.quocTich}</td>
                                            <td>${tinhThanh}</td>
                                            <td>
                                                <div>Ẩm thực: ${chuongTrinhThamGiaCount}</div>
                                                <div>${chuongTrinhThamGiaList}</div>
                                            </td>
                                            <td>
                                                <div>Ẩm thực: ${chuongTrinhHoanThanhCount}</div>
                                                <div>${chuongTrinhHoanThanhList}</div>
                                            </td>
                                            <td>${diemThamQuanList}</td>
                                            <td>${chuongTrinhMonAn}</td>
                                            <td>${diemKinhNghiemList}</td>
                                        </tr>`;
                            });
                            $('#dataGridHoChieuThamGia tbody').html(html);
                        } else {
                            console.error("Dữ liệu không hợp lệ hoặc API không thành công:", data.message);
                            $('#dataGridHoChieuThamGia tbody').html('<tr><td colspan="5">Không có dữ liệu</td></tr>');
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error("Lỗi khi gọi API:", error);
                        $('#dataGridHoChieuThamGia tbody').html('<tr><td colspan="5">Lỗi khi tải dữ liệu</td></tr>');
                    }
                });
            }
        });

    </script>
    @*  <script src="~/views/thongke/index.js"></script> *@
}