@{
    var userData = User.GetUserData();
}
<header class="fixed top-0 w-full z-50 bg-white shadow">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">

            <!-- Logo -->
            <a href="~/Home/Index" class="flex items-center space-x-2">
                <h2 class="text-blue-600 font-bold text-2xl">CookinRecipe</h2>
            </a>

            <!-- Navigation Menu -->
            <div class="hidden md:flex items-center space-x-6">
                <a href="@Url.Action("Index", "Recipe")" class="text-blue-600 font-medium hover:text-blue-800">Công thức</a>
                <a href="@Url.Action("Index", "Course")" class="text-blue-600 font-medium hover:text-blue-800">Thực đơn</a>
                <a href="@Url.Action("Index", "Ingredient")" class="text-blue-600 font-medium hover:text-blue-800">Nguyên liệu</a>
                @if (userData != null && userData.Roles.Contains("admin"))
                {
                    <a href="@Url.Action("Index", "Management")" class="text-blue-600 font-medium hover:text-blue-800">Quản lý</a>
                }
            </div>

            <!-- User Actions -->
            <div class="flex items-center space-x-4">
                @{
                    if (userData != null)
                    {
                        <!-- Notifications -->
                        // <div class="relative">
                        //     <button id="messageButton" data-userid="@userData.UserId" class="text-blue-600 hover:text-blue-700">
                        //         <i class="fas fa-bell text-xl"></i>
                        //     </button>
                        //     <div id="messageDropdown"
                        //          class="hidden absolute right-0 mt-2 w-64 max-h-60 bg-white shadow-lg rounded-lg overflow-y-auto z-50">
                        //         <div id="noti-loading" class="p-3 text-center text-gray-500">Đang tải thông báo...</div>
                        //     </div>
                        // </div>

                        <!-- Avatar Dropdown -->
                        <div class="relative">
                            <button id="avaButton">
                                <img src="~/FileUpload/images/user/@userData.UserImage" class="w-8 h-8 rounded-full" alt="Avatar" />
                            </button>
                            <div id="avaDropdown"
                                 class="hidden absolute right-0 mt-2 w-52 bg-white shadow-lg rounded-lg overflow-hidden z-50">
                                <!-- Nội dung dropdown -->
                                <div class="flex items-center p-3 border-b">
                                    <img src="~/FileUpload/images/user/@userData.UserImage" class="w-12 h-12 rounded-full" />
                                    <div class="ml-3">
                                        <p class="text-gray-800 font-bold truncate">@userData.FullName</p>
                                        <a href="~/User/Index" class="text-blue-600 text-sm font-sans">Xem trang cá nhân</a>
                                    </div>
                                </div>
                                <div class="p-2 divide-y text-gray-700">
                                    <a href="~/Recipe/Create" class="flex items-center p-2 hover:bg-gray-100 font-sans">
                                        <i class="fas fa-pen mr-2"></i> Tạo công thức mới
                                    </a>
                                    <a href="~/Favourite/Index" class="flex items-center p-2 hover:bg-gray-100 font-sans">
                                        <i class="fas fa-thumbs-up mr-2"></i> Đã thích
                                    </a>
                                    <a href="~/List/Index" class="flex items-center p-2 hover:bg-gray-100 font-sans">
                                        <i class="fas fa-bookmark mr-2"></i> Danh sách lưu
                                    </a>
                                    <a href="~/Account/ChangePassword" class="flex items-center p-2 hover:bg-gray-100 font-sans">
                                        <i class="fas fa-key mr-2"></i> Đổi mật khẩu
                                    </a>
                                    <a href="~/Account/Logout" class="flex items-center p-2 hover:bg-gray-100 font-semibold text-red-600 font-sans">
                                        <i class="fas fa-sign-out-alt mr-2"></i> Đăng xuất
                                    </a>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <a href="~/Account/Login" class="text-blue-600 hover:text-blue-800 font-medium">Đăng nhập</a>
                        <a id="nav-signup-btn" href="~/Account/SignUp" class="md:flex hidden">
                            <button class="bg-gradient-to-r from-blue-600 to-purple-600 hover:bg-blue-700 duration-300 text-white text-base font-regular py-2 px-4 rounded">
                                Đăng ký
                            </button>
                        </a>
                    }
                }

                <!-- Mobile Menu Toggle -->
                <div class="md:hidden">
                    <button class="mobile-menu-button">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                            <path d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="hidden mobile-menu md:hidden mt-2 space-y-2 px-4 pb-4 border-t pt-4">
        @if (userData == null)
                    {
                <a href="~/Account/Login" class="font-sans block text-center text-blue-600">Đăng nhập</a>
                <a href="~/Account/SignUp" class="font-sans text-center block text-blue-600">Đăng ký</a>
                    }
            <a href="~/Recipe/Index" class="font-sans text-center block">Công thức</a>
            <a href="~/Course/Index" class="font-sans text-center block">Thực đơn</a>
            <a href="~/Ingredient/Index" class="font-sans text-center block">Nguyên liệu</a>
            @if (userData != null && userData.Roles.Contains("admin"))
            {
            <a href="~/Management/Index" class="font-sans text-center block">Quản lý</a>
            }
        </div>
    </nav>

    <script>
        // Toggle dropdown
        document.getElementById("avaButton")?.addEventListener("click", () => {
            document.getElementById("avaDropdown")?.classList.toggle("hidden");
        });

        // document.getElementById("messageButton")?.addEventListener("click", () => {
        //     const userId = $("#messageButton").data("userid");
        //     $("#messageDropdown").html('<div class="p-3 text-center text-gray-500">Đang tải thông báo...</div>');
        //     $.get(`/Notification/GetNotifications/${userId}`, function (data) {
        //         $("#messageDropdown").html(data).removeClass("hidden");
        //     });
        // });

        document.addEventListener("click", (e) => {
            const avatar = document.getElementById("avaButton");
            const dropdown = document.getElementById("avaDropdown");
            if (!avatar.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.classList.add("hidden");
            }

            // const msgBtn = document.getElementById("messageButton");
            // const msgDropdown = document.getElementById("messageDropdown");
            // if (!msgBtn.contains(e.target) && !msgDropdown.contains(e.target)) {
            //     msgDropdown.classList.add("hidden");
            // }
        });

        // Mobile toggle
        document.querySelector(".mobile-menu-button")?.addEventListener("click", () => {
            document.querySelector(".mobile-menu")?.classList.toggle("hidden");
        });
    </script>
</header>
